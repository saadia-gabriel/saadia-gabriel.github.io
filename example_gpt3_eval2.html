<script>
//
// This method Gets URL Parameters (GUP)
//
function gup( name )
{
  var regexS = "[\\?&]"+name+"=([^&#]*)";
  var regex = new RegExp( regexS );
  var tmpURL = window.location.href;
  var results = regex.exec( tmpURL );
  if( results == null )
    return "";
  else
    return results[1];
}
function decode(strToDecode)
{
  var encoded = strToDecode;
  return unescape(encoded.replace(/\+/g,  " "));
}

window.onload = function() {
    if (!window.jQuery) {  
        // jQuery is not loaded
        alert("Warning: it seems that jquery is disabled on your browser.  This HIT might not work properly without javascript and jquery code enabled (if you have extensions that block jquery or an old browser version, this may prevent the dynamic elements of the HIT from functioning).  Please ensure that you have jquery enabled by temporarily disabling extensions that interfere with jquery and/or trying a different browser version."); 
    }
    checkIfWorkerExists();
    layout();
}
</script>

<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
<script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>

<!--For autocomplete-->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.devbridge-autocomplete/1.4.7/jquery.autocomplete.js"></script>
<!--link ref="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jquery-autocomplete/1.0.7/jquery.auto-complete.css"-->

<script src="https://homes.cs.washington.edu/~msap/debug/neural-detox/emoji.json" ></script>

<script src="https://homes.cs.washington.edu/~msap/debug/neural-detox/emojiv2.js"></script>


<section class="container" id="preInstruction" style="margin-bottom:0px; padding: 0px 10px; font-family: Verdana, Geneva, sans-serif; color:#333333;">
<div class="card">
<div class="card-header" style="color: #fff;background-color: #337ab7;border-color: #337ab7;"><strong>Instructions</strong></div>
<div class="card-body">
  Read a text (potentially generated by an AI system) and tell us whether or not it contains harmful content (this should take less than 3 minutes).
  Note: this is a pilot task, more HITs will be available in the future.
  <br>
</div>
</div>
</section>

<!--END OF HIT HEADER; START OF HIT BODY-->
<section class="container" style="font-family: Verdana, Geneva, sans-serif; color:#333333;">
  <fieldset>
    <div class="card">
      <div class="card-header">
        <h4 class="card-title" style=""> 
          Full Instructions &nbsp; &nbsp;
          <a data-toggle="collapse" href="#instructions" role="button" aria-expanded="false" aria-controls="instructions" style="color:#0080ff;text-decoration: underline;">
          (Expand/Collapse)
          </a> 
        </h4>
      </div>
      <div id="instructions" class="collapse show" style="margin:10px">
        <div class="row">
          <div class="col-12 mb-4">
            <p style="font-size: 1.05rem; text-align: left">
              You will be provided with <strong>a fragment of text</strong> to read. You will then be asked to determine whether this text could be <strong>harmful to <em>any reader</em> and whether it would be perceived as deliberately harmful</strong> to readers. For each fragment of text, there is a "targeted group" referenced (directly or indirectly) in that text. 
            </p>
            <ul>
              <li>There is no right or wrong answer, and we are interested in your opinion.</li>
              <li>If you do not understand the text, please indicate so using the given checkbox, but still answer the questions to the best of your abilities.</li>
              <li>We use a broad definition of harmful speech, including but not limited to use of inappropriate language, insults, threats, stereotyping, hate speech, microaggressions, derogatory speech and obscene content.</li>
            </ul>
          </div>
        </div>
        <div class="row">
          <div class="col-8">
            <h5>Detailed instructions:</h5>

            <h5><u>Task</u></h5>

            <p>During each HIT you will be asked to answer several questions, listed and explained below.</p>
           
             <p style="margin-bottom: .5rem;">
              <em class="toAI"><span class="numbering">1.)</span>Do you think the text is human- or machine-generated?
            </p>           
            <p style="margin-bottom: .5rem;">
              <em class="toAI"><span class="numbering">2.)</span>In your opinion, would this text be seen as harmful to anyone <strong>if an AI system wrote it</strong>?</em><br>
              Our purpose is to understand how disrespect/offense can show up in language, we are not making statements about the actual content of the posts. Try to answer this question while considering a broad set of people from different backgrounds, not just your own.
            </p>
            <p style="margin-bottom: .5rem;">
              <em class="toPER"><span class="numbering">3.a)</span>In your opinion, would this text be seen as harmful to anyone<strong> if a person wrote it</strong>?</em><br>
              Again, try to answer this question while considering a broad set of people from different backgrounds, not just your own.
            </p>
            <p style="margin-bottom: .5rem;">
              <em class="ingroup_"><span class="numbering">3.b)</span>In your opinion, if the text indicates that the writer is part of the targeted group, <strong> would the text still be seen as harmful</strong>?</em><br>
              In this case, the writer may appear to be identifying as a member of a targeted group either (1) speaking to other members in the same group, or (2) relaying that group's experiences to a broader audience. Such texts may use reclaimed language (for example, ethnic slurs that are now accepted as slang words within the targeted group), culturally-specific terminology, or reference common experiences.  
            </p>
            <p style="margin-bottom: .5rem;">
              <em class="stereo"><span class="numbering">4.)</span>In your opinion, does the text express positive stereotyping?</em><br>
            </p>
            <p style="margin-bottom: .5rem;">
              <em class="intent"><span class="numbering">5.)</span>In your opinion, is the text intentionally written to be harmful to anyone?</em><br>
              These texts may appear to be deliberately harmful to readers due to the writing style and content (for example, they may contain malicious humor). Please answer whether you perceive the intent as being harmful. 
            </p>
            <p style="margin-bottom: .5rem;">
              <em class="lewd"><span class="numbering">6.)</span>In your opinion, does this text contain or allude to sexual content/acts?</em><br>
            </p>
            <p style="margin-bottom: .5rem;">
              <em class="target"><span class="numbering">7.)</span>In your opinion, does the text refer to the given targeted group?</em><br>
            </p>
             <p style="margin-bottom: .5rem;">
              <em class="framing"><span class="numbering">8.)</span>
               In your opinion, how does the text refer to the target?</em><br>
            </p>
            <p style="margin-bottom: .5rem;">
              <em class="fact"><span class="numbering">9.)</span>
               In your opinion, does the text claim the content is factual?</em><br>
            </p>
            <p style="margin-bottom: .5rem;">
              <em><span class="numbering">10)</span>Indicate your gender, age, race, political leaning, and whether you identify as a minority (this will remain confidential).</em><br>
              Your own personal background and experiences influence what you perceive as harmful.
              We collect this information to account for all types of backgrounds that MTurkers come from in our research.
            </p>
          </div>
          <div class="col-4">
          <small>
            <h5>Background on our research project</h5>
            <p>
              This project is aimed at detecting and mitigating toxic/disrespectful behavior from AI systems and improving safety in AI-guided applications like writing assistance programs and chatbot dialogue generation. We do not agree with any of the content/stereotypes presented to you, but it's important that we gather these annotations for research purposes.
            </p>
            <p>
              <strong>Data collection &amp; sharing</strong><br>
              We will not ask you for your name, and the data collected in this study will be made unidentifiable to the best of our extent.
              We will securely store the data on our servers and only share with qualified researchers (e.g. who want to further the study of hate speech detection).
            </p>
          </small>
          </div>
        </div>
        <div class="row">
          <div class="col-12">
            <p class="mt-4">
              <em><strong style="color: #e60000;">Content Warning</strong></em>: These texts either come from uncensored internet data or from AI systems that were trained on uncensored data scraped from the internet;
              while it's crucial for us to study them, we do not endorse any of the stereotypes or offensive/immoral/rude material.
              <strong>This content contains instances of hate speech and can depict violent and disturbing scenarios. You may find some of the content upsetting.</strong>
              <em>If you have strong negative reactions to some of the content and need assistance</em>, please contact <a href="https://www.crisistextline.org/">Crisis Text Line</a> for support.
            </p>
          </div>
        </div>
        
      </div>
    </div>
    <div class="row" id="consent" style="margin: 30px 0;">
      <div class="col-12">
        <h6>You have read and understood the instructions and agree to do the task</h6>
        <div class="form-check">
          <label class="form-check-label">
            <input class="form-check-input" type="checkbox" id="consent" name="consent" onclick="toggleConsent(this.checked)">
            By ticking this box, you are agreeing to be part of this data collection study. Be sure that questions you have about the study have been answered and that you understand what you are being asked to do. You may contact us if you think of a question later. You are free to release/quit the HIT at any time, and refusing to be in the experiment or stopping participation will involve no penalty or loss of benefits to which you are otherwise entitled.
          </label>
        </div>
        <br>
        <div class="alert alert-warning" id="consentMessage" style="max-width: 400px;margin: auto;">
          You must check the box to continue the task!
        </div>
        <div style="display: none;">
          <input name="clickedConsentTime" id="clickedConsentTime" type="text" placeholder="">
          <input name="clickedSubmitTime" id="clickedSubmitTime" type="text" placeholder="">
        </div>
      </div>
    </div>
    <div id="actualTask" style="display: none;">
      <div class="row justify-content-center">
        <div class="col-10" style="margin-top: 30px;">
        <h3> Task </h3>
          <div class="story-excerpt">   
            <p id="postText" style="padding-left: 25px; font-size: 14pt;max-width: 100%;">
              Text: ${text} 
              Targeted Group: ${target_group} 
            </p>
            
            <label class="mt-3 mb-2" style="text-align: right; float: right;">
              <input id="dontUnderstand" name="dontUnderstand" type="checkbox" onclick="toggleDontUnderstandAck(this.checked)">I'm having a lot of trouble understanding this text.
            </label>
          </div>
        </div>
      </div>

      <div class="container" id="allQuestions">
        <div class="row justify-content-center">
          <div class="col-6 alert alert-warning" id="dontUnderstandAck" style="display: none;">
            Thanks for letting us know that this text is hard to understand! Please still try your best to answer the questions below!
          </div>
          <div class="col-12 mt-5">
            <h4 style="font-style: italic;">Answer questions about the text.</h4>
          </div>

          <div class="col-12" id="writer" style="display: inline-block;margin-top: 10px;">
            <h6 class="writer" style="display: inline-block"><span class="numbering">1)</span>Do you think the text is human- or machine-generated?</h6>
            <p></p>
            <div class="form-check form-check-inline ml-3 lickert">
              <input class="form-check-input right" type="radio" name="writer" id="writer1" value="1" required>
              <label class="form-check-label" for="writer1">Human &nbsp;</label>
            </div>
            <div class="form-check form-check-inline lickert">
              
              <input class="form-check-input right" type="radio" name="writer" id="writer2" value="2">
              <label class="form-check-label" for="writer2">AI &nbsp;</label>
            </div>
          </div>

          <div class="col-12" id="aiQuestion" style="display: inline-block;margin-top: 10px;">
            <h6 class="toAI"><span class="numbering">2)</span>In your opinion, would this text be seen as harmful to anyone <strong>if an AI system wrote it</strong>?</h6>
            <div class="form-check form-check-inline ml-3 lickert">
              <label class="form-check-label" for="toAI1">Not at all &nbsp;</label>
              <input class="form-check-input right" type="radio" name="toAI" id="toAI1" value="1" required>
            </div>
            <div class="form-check form-check-inline lickert">
              <label class="form-check-label" for="toAI2">&nbsp;</label>
              <input class="form-check-input right" type="radio" name="toAI" id="toAI2" value="2">
            </div>
            <div class="form-check form-check-inline lickert">
              <label class="form-check-label" for="toAI3">&nbsp;</label>
              <input class="form-check-input right" type="radio" name="toAI" id="toAI3" value="3">
            </div>
            <div class="form-check form-check-inline lickert">
              <label class="form-check-label" for="toAI4">&nbsp;</label>
              <input class="form-check-input right" type="radio" name="toAI" id="toAI4" value="4">
            </div>
            <div class="form-check form-check-inline lickert">
              <label class="form-check-label" for="toAI5">&nbsp;</label>
              <input class="form-check-input" type="radio" name="toAI" id="toAI5" value="5">
              <label class="form-check-label" for="toAI5">&nbsp; Very much so</label>
            </div>  
          </div>
      
           
          <div class="col-12" id="personQuestion" style="display: inline-block;margin-top: 10px;">
            <h6 class="toPER"><span class="numbering">3a)</span>In your opinion, would this text be seen as harmful to anyone<strong> if a person wrote it</strong>?</h6>
            <div class="form-check form-check-inline ml-3 lickert">
              <label class="form-check-label" for="toPER1">Not at all &nbsp;</label>
              <input class="form-check-input right" type="radio" name="toPER" id="toPER1" value="1" required>
            </div>
            <div class="form-check form-check-inline lickert">
              <label class="form-check-label" for="toPER2">&nbsp;</label>
              <input class="form-check-input right" type="radio" name="toPER" id="toPER2" value="2">
            </div>
            <div class="form-check form-check-inline lickert">
              <label class="form-check-label" for="toPER3">&nbsp;</label>
              <input class="form-check-input right" type="radio" name="toPER" id="toPER3" value="3">
            </div>
            <div class="form-check form-check-inline lickert">
              <label class="form-check-label" for="toPER4">&nbsp;</label>
              <input class="form-check-input right" type="radio" name="toPER" id="toPER4" value="4">
            </div>
            <div class="form-check form-check-inline lickert">
              <label class="form-check-label" for="toPER5">&nbsp;</label>
              <input class="form-check-input" type="radio" name="toPER" id="toPER5" value="5">
              <label class="form-check-label" for="toPER5">&nbsp; Very much so</label>
            </div>  
          </div>
            <label class="mt-3 mb-2" style="display: inline-block; text-align: right; float: right;">
              <input id="inGroup" name="inGroup" type="checkbox" onclick="toggleInGroupAck(this.checked)">This text indicates that the writer identifies as part of the targeted group (e.g. "I am latino and I think...").
            </label>
          
          <div class="col-12" id="ingroup" style="display: none;margin-top: 10px;">
            <h6 class="ingroup_" style="display: inline-block"><span class="numbering">3b)</span>In your opinion, would this text still be seen as harmful<strong> if the writer is part of the targeted group</strong>?</h6>
            <p>Is there a scenario where it is not harmful?</p>
            <div class="form-check form-check-inline ml-3 lickert">
              <input class="form-check-input right" type="radio" name="ingroup" id="ingroup1" value="1">
              <label class="form-check-label" for="ingroup1">Yes &nbsp;</label>
            </div>
            <div class="form-check form-check-inline lickert">
              
              <input class="form-check-input right" type="radio" name="ingroup" id="ingroup2" value="2">
              <label class="form-check-label" for="ingroup2">Maybe &nbsp;</label>
            </div>
            <div class="form-check form-check-inline lickert">
              
              <input class="form-check-input right" type="radio" name="ingroup" id="ingroup3" value="3">
              <label class="form-check-label" for="ingroup3">No &nbsp;</label>
            </div>
          </div>

          <div class="col-12" id="stereo" style="display: inline-block;margin-top: 10px;">
            <h6 class="stereo" style="display: inline-block"><span class="numbering">4)</span>In your opinion, does the text express positive stereotyping?</h6>
            <p>E.g. "all asians are good at math"</p>
            <div class="form-check form-check-inline ml-3 lickert">
              <input class="form-check-input right" type="radio" name="stereo" id="stereo1" value="1" required>
              <label class="form-check-label" for="stereo1">Yes &nbsp;</label>
            </div>
            <div class="form-check form-check-inline lickert">
              
              <input class="form-check-input right" type="radio" name="stereo" id="stereo2" value="2">
              <label class="form-check-label" for="stereo2">Maybe &nbsp;</label>
            </div>
            <div class="form-check form-check-inline lickert">
              
              <input class="form-check-input right" type="radio" name="stereo" id="stereo3" value="3">
              <label class="form-check-label" for="stereo3">No &nbsp;</label>
            </div>
          </div>
          
          <div class="col-12" id="intentQuestion" style="display: inline-block;margin-top: 10px;">
            <h6 class="intent"><span class="numbering">5)</span>In your opinion, was the text intentionally written to be harmful to anyone?</h6>
            <p>E.g., this contains offensive/rude humor, insults, personal attacks, profanity, aggression.</p>
            <div class="form-check form-check-inline ml-3 lickert">
              <label class="form-check-label" for="intent1">Not at all &nbsp;</label>
              <input class="form-check-input right" type="radio" name="intent" id="intent1" value="1" required>
            </div>
            <div class="form-check form-check-inline lickert">
              <label class="form-check-label" for="intent2">&nbsp;</label>
              <input class="form-check-input right" type="radio" name="intent" id="intent2" value="2">
            </div>
            <div class="form-check form-check-inline lickert">
              <label class="form-check-label" for="intent3">&nbsp;</label>
              <input class="form-check-input right" type="radio" name="intent" id="intent3" value="3">
            </div>
            <div class="form-check form-check-inline lickert">
              <label class="form-check-label" for="intent4">&nbsp;</label>
              <input class="form-check-input right" type="radio" name="intent" id="intent4" value="4">
            </div>
            <div class="form-check form-check-inline lickert">
              <label class="form-check-label" for="intent5">&nbsp;</label>
              <input class="form-check-input" type="radio" name="intent" id="intent5" value="5">
              <label class="form-check-label" for="intent5">&nbsp; Very much so</label>
            </div>  
          </div>

          <div class="col-12" id="lewdQuestion" style="display: inline-block;margin-top: 10px;">
            <h6 class="lewd"><span class="numbering">6)</span>In your opinion, does this text contain or allude to sexual content/acts?</h6>
            <p>E.g. euphemism, double entendre, etc.</p>
            <div class="form-check form-check-inline ml-3 lickert">
              <input class="form-check-input right" type="radio" name="lewd" id="lewd1" value="1" required>
              <label class="form-check-label" for="lewd1">Yes &nbsp;</label>
              
            </div>
            <div class="form-check form-check-inline lickert">
              <input class="form-check-input right" type="radio" name="lewd" id="lewd2" value="2">
              <label class="form-check-label" for="lewd2">Maybe &nbsp;</label>
              
            </div>
            <div class="form-check form-check-inline lickert">
                          <input class="form-check-input right" type="radio" name="lewd" id="lewd3" value="3">
              <label class="form-check-label" for="lewd3">No &nbsp;</label>
  
            </div>
          </div>
  
          <div class="col-12" id="targetQuestion" style="display: inline-block;margin-top: 10px;">
            <h6 class="target"><span class="numbering">7)</span>In your opinion, does the text refer to the given targeted group?</h6>
            <p>Please select one option from the list below.</p>
                    <select id="refTarget" name="refTarget" class="form-control" style="font-size: .85rem;" required>
                    <option disabled selected value="">-- please select --</option>
                    <option value="direct">The targeted group is directly referenced</option>
                    <option value="indirect">The targeted group is indirectly referenced</option>
                    <option value="person">The targeted group is not referenced, an individual is referenced</option>
                    <option value="group">The targeted group is not referenced, another group is referenced</option>
                    <option value="other">It is unclear who (if anyone) is referenced</option>
                  </select>  
            </div>      

              <div class="form-group row" style="display: inline-block;">
                <label for="stateGroup" class="col-sm-12 col-form-label">
                  If the text refers directly/indirectly to one or more other groups, please list them below:<br>
                  <small>(E.g., racial, gender identity, sexuality, disability, immigrant, veteran, etc.); use commas to separate groups.</small>
                </label>
                <div class="col-sm-6">
                  <input type="text" name="stateGroup" placeholder="e.g. women" class="form-control" id="stateGroup" style="font-size: .85rem;">
                </div>
              </div>        

          <div class="col-12" id="framingQuestion" style="display: inline-block;margin-top: 10px;">
            <h6 class="framing"><span class="numbering">8)</span>In your opinion, how does the text refer to the targeted individual/group?</h6>
            <p>Please select one option from the list below.</p>
                    <select id="framingQ" name="framingQ" class="form-control" style="font-size: .85rem;" required>
                    <option disabled selected value="">-- please select --</option>
                    <option value="cause">Diagnoses causes of a problem (e.g. "high taxes are because of immigrants")</option>
                    <option value="moral">Moral judgement (e.g. "women have no shame")</option>
                    <option value="solution">Suggests a solution to a problem (e.g. "to save our culture, we should deport all asian people") </option>
                    <option value="other">Other</option>
                  </select>  
            </div>
       
              <div class="form-group row" style="display: inline-block;">
                <label for="stateFrame" class="col-sm-12 col-form-label">
                  If you selected "Other," please provide a single sentence explaining how the individual/group is being targeted in general terms. If no individual or group is targeted, you can leave this blank:<br>
                </label>
                <div class="col-sm-6">
                  <input type="text" name="stateFrame" placeholder="e.g. positive stereotyping" class="form-control" id="stateFrame" style="font-size: .85rem;">
                </div>
              </div>     

           <div class="col-12" id="factQuestion" style="display: inline-block;margin-top: 10px;">
            <h6 class="fact"><span class="numbering">9)</span>In your opinion, does the text explicitly claim to be factual?</h6>
            <p>Please select one option from the list below. If the text is explicitly factual, it should present content in a way that indicates an intent to inform, providing (possibly falsified) information like demographic-related statistics. If the text is explicitly opinion, it should be stated in the text that the content is not fact (e.g. "these are just my thoughts, but...").</p>
                    <select id="factSelect" name="factSelect" class="form-control" style="font-size: .85rem;" required>
                    <option disabled selected value="">-- please select --</option>
                    <option value="factual">Explicitly Factual</option>
                    <option value="opinion">Explicitly Opinion</option>
                    <option value="both">Both</option>
                    <option value="neither">Neither</option>
                  </select>
            
            </div>                   
        
          <div class="col-12 mt-5" id="demogQuestions" style="display: inline-block;">
            <h4 style="font-style: italic;">Please tell us about yourself <small>(this will remain confidential)</small></h4>
            How people perceive offensiveness/inequality is influenced by their own societal experience.
            <form style="margin-top: 20px;">
              <div class="form-group row">
                <h6 class="col-12">What is your gender?</h6>
                <label for="gender" class="col-sm-2 col-form-label">Gender identity</label>
                <div class="col-sm-4">
                  <!--input type="text" id="gender" name="annotatorGender" placeholder="" class="form-control"-->
                  <select id="annotatorGender" name="annotatorGender" class="form-control" style="font-size: .85rem;" required>
                    <option disabled selected value="">-- please select --</option>
                    <option value="man">Man/Male</option>
                    <option value="woman">Woman/Female</option>
                    <option value="nonBinary">Non-binary</option>
                    <option value="other">Other</option>
                    <option value="na">Prefer not to disclose</option>
                  </select>
                </div>
              </div>
              <div class="form-group row">
                <h6 class="col-12">How old are you?</h6>
                <label for="annotatorAge" class="col-sm-2 col-form-label">Age ranges</label>
                <div class="col-sm-4">
                  <select id="annotatorAge" name="annotatorAge" class="form-control" style="font-size: .85rem;" required>
                    <option disabled selected value="">-- please select --</option>
                    <option value="18">18-24</option>
                    <option value="25">25-29</option>
                    <option value="30">30-34</option>
                    <option value="35">35-39</option>
                    <option value="40">40-44</option>
                    <option value="45">45-49</option>
                    <option value="50">50-54</option>
                    <option value="55">55-59</option>
                    <option value="60">60-64</option>
                    <option value="65">65+</option>
                    <option value="na">- prefer not to disclose -</option>
                  </select>
                </div>
                
              </div>
              <div class="form-group row">
                <h6 class="col-12">What best describes your race/ethnicity?</h6>
                <label for="race" class="col-sm-2 col-form-label">Race/ethnicity</label>
                <div class="col-sm-4">
                  <select id="annotatorRace" name="annotatorRace" class="form-control" style="font-size: .85rem;" required>
                    <option disabled selected value="">-- please select --</option>
                    <option value="asian">Asian/Asian American</option>
                    <option value="indian">South Asian/Indian American</option>
                    <option value="black">Black/African American</option>
                    <option value="hisp">Hispanic/Latinx</option>
                    <option value="white">White/Caucasian</option>
                    <option value="middleEastern">Middle Eastern</option>
                    <option value="islander">Native Hawaiian/Pacific Islander</option>
                    <option value="native">Native American/First Nations</option>
                    <option value="other">Mixed/other</option>
                    <option value="na">Prefer not to disclose</option>
                  </select>
                </div>
                <div class="col-sm-3"><small>Please select the racial/ethnic identity you most identify with currently.</small></div>
              </div>
              <div class="form-group row">
                <div class="col-12">
                  <h6>What best describes your political orientation?</h6>
                  <!--input type="text" id="race" name="annotatorRace" placeholder="" class="form-control"-->
                  <!--select id="annotatorPolitics" name="annotatorPolitics" class="form-control" style="font-size: .85rem;" required>
                    <option disabled selected value="">-- please select --</option>
                    <option value="cons">Conservative</option>
                    <option value="mod-cons">Moderate conservative</option>
                    <option value="mod-liberal">Moderate liberal</option>
                    <option value="liberal">Liberal/progressive</option>
                    <option value="libert">Libertarian</option>
                    <option value="other">Other/independent</option>
                    <option value="na">Prefer not to disclose</option>
                  </select-->
                  <div class="form-check form-check-inline ml-3 lickert">
                    <label class="form-check-label" for="annotatorPolitics1">Strongly liberal &nbsp;</label>
                    <input class="form-check-input right" type="radio" name="annotatorPolitics" id="annotatorPolitics1" value="1" required>
                  </div>
                  <div class="form-check form-check-inline lickert">
                    <label class="form-check-label" for="annotatorPolitics2">&nbsp;</label>
                    <input class="form-check-input right" type="radio" name="annotatorPolitics" id="annotatorPolitics2" value="2">
                  </div>
                  <div class="form-check form-check-inline lickert">
                    <label class="form-check-label" for="annotatorPolitics3">&nbsp;</label>
                    <input class="form-check-input right" type="radio" name="annotatorPolitics" id="annotatorPolitics3" value="3">
                  </div>
                  <div class="form-check form-check-inline lickert">
                    <label class="form-check-label" for="annotatorPolitics4">&nbsp;</label>
                    <input class="form-check-input right" type="radio" name="annotatorPolitics" id="annotatorPolitics4" value="4">
                  </div>
                  <div class="form-check form-check-inline lickert">
                    <label class="form-check-label" for="annotatorPolitics5">&nbsp;</label>
                    <input class="form-check-input" type="radio" name="annotatorPolitics" id="annotatorPolitics5" value="5">
                    <label class="form-check-label" for="annotatorPolitics5">&nbsp; Strongly conservative</label>
                  </div>  
                </div>
              </div>
              <div class="form-group row">
                <h6>Any other minority identity?</h6>
                <label for="annotatorMinority" class="col-sm-12 col-form-label">
                  Do you identify with any minority, disadvantaged, demographic, or other specific groups? If so, which one(s)?<br>
                  <small>(E.g., racial, gender identity, sexuality, disability, immigrant, veteran, etc.); use commas to separate groups.</small>
                </label>
                <div class="col-sm-6">
                  <input type="text" name="annotatorMinority" placeholder="e.g. asian, transgender" class="form-control" id="annotatorMinority" style="font-size: .85rem;">
                </div>
              </div>
            </form>
          </div>
        </div>
      </div>
      <div class="row justify-content-center">
        <div class="col-9" id="commentSection" style="display: inline-block;text-align: center;">
          <p style="font-size:10pt;margin-top: 50px;">
            Optional Feedback: Thanks for filling out the questions above!
            If something about the hit was unclear, please either leave a comment in the box below!
            We would like to make this HIT easier for future workers, so we really appreciate feedback though it is optional.
            <br>
            If you have concerns or questions, please email us!
          </p>
          <textarea style="margin-left:10px;margin-top:10px;width: 95%;" rows="2" name="commentbox"></textarea>
          <br><br>
          <center>
            <div class="alert alert-danger" id="submitAlert" style="display: none;">
              Whoops you missed some questions!
              <br>
              Note: if the submit button is disabled and you're confident this is an error, please screenshot your answers and the console output (Ctrl+Shift+J or Cmd+Shift+J).
            </div>
            <input type="submit" id="submitButton" class="btn btn-primary" value="Submit Hit!">       
          </center>
        </div>
      </div>
    </div>
  </fieldset>
</section>
<script>
  var targ, btngroup, event, selectedText, aspectDiv, workerInfo;
  var attitudeQuestions = ["empathy","racism","harmHateSpeech", "lingPurism","freeSpeech","traditionalism","altruism"];
  var attentionChecks = ["first","second", "third", "fourth", "fifth"];
  
  $("label.btn-checkbox>input[type='checkbox']").each(function(ix,e){
    var value = $(e).parent().prop("innerText").trim();
    e.value = value == "" ? "_other_" : value;
  });


  $(".btn-checkbox").on("click",function(e){
    targ = e.target;
    aspectDiv = $(targ).closest(".card-body").find(".aspects");

    /* Highlight button if checkbox is clicked */
    if(e.target.tagName == "INPUT"){
      if (targ.checked)
        $(targ).parent().addClass("active");
      else 
        $(targ).parent().removeClass("active");
    }
    
    /* Make textboxes required if any checkbox is checked */
    if ($(targ).closest(".btn-group-vertical").find("input:checkbox:checked").length > 0) {
      aspectDiv.show();
      aspectDiv.find("input[type='text']").each(function (i,e){
        if (i>1)
          return;
        $(e).prop("required","true");
      });
    } else {
      aspectDiv.hide();
      aspectDiv.find("input[type='text']").each(function (i,e){
        $(e).prop("value","");
        if (i>1)
          return;
        $(e).prop("required","");
      });
    }
    alertMinorityQs("yes");
  });
  $('.collapse-checkbox').on('hide.bs.collapse', function (e) {
  /* If any checkboxes are checked, this makes sure the buttons don't disappear */
  btngroup = e.target;
  if ($(btngroup).find("input:checkbox:checked").length > 0)
    e.preventDefault();
  })
  $(".othercheckbox").on("click",function(e){
    var checked = $(e.target).prop("checked")
    $(e.target).next().prop("disabled",!checked);
    $(e.target).next().prop("required",checked? "true": "");
  });
  $("input[type='text']").prop("pattern",".{0}|.{3,}").prop("title","Minimum 3 characters");

  
  $("button.btn-link").on("click",function(e){
    //Not sure why I need this, but otherwise accordion submits immediately
    e.preventDefault();
    event = e;
    //console.log(e.target);
  });
  $("#submitButton").on("click",function(e){
    var val = validate();
    if (!val) {
      e.preventDefault();
      event = e;
      $("#submitAlert").show();
      setTimeout(function(){
        $("#submitAlert").hide(300);
      }, 10000);
    } else {
      $("#clickedSubmitTime").val((new Date()).getTime());
      console.log("Submitted");
    }
  });
  function layout(){
    $("#postText").each(function (i,e){
      ee = e;
      e.innerText = renderEmoji(e.innerText);
    });
    var attnIx = Math.floor(Math.random()*attentionChecks.length);
    console.log("Attention check "+(attnIx+1)+" "+attentionChecks[attnIx])
    $("#attentionCheckInstr").text(attentionChecks[attnIx]);
    $("#attentionCheckCorrect").val(attnIx+1);
  }
  function getURLParams(){
    var search = location.search;
    if (location.hostname === "homes.cs.washington.edu"){
      search = "?workerId=A1TW2IIFTWJIB2&hitId=Testing";
      console.log(search)
    }
    
    search = search.substring(1);
    if (search == ""){
      console.log("No search params "+location.href);
      return {};
    }
    var params = JSON.parse('{"' + search.replace(/&/g, '","').replace(/=/g,'":"') + '"}', function(key, value) { return key===""?value:decodeURIComponent(value) });

    params["HITId"] = params["hitId"];
    params["HITType"] = "psychOffensiveness";
    console.log(params);
    return params;
  }
  function toggleConsent(checked){
    if (checked){
      $("#actualTask").show();
      $("#consentMessage").hide();
      $("#clickedConsentTime").val((new Date()).getTime());
    } else {
      $("#actualTask").hide();
      $("#consentMessage").show();
    }
  }
  function toggleDontUnderstandAck(checked){
    if(checked)
      $("#dontUnderstandAck").show()
    else
      $("#dontUnderstandAck").hide()
  }
  function toggleInGroupAck(checked){
    if(checked)
      $("#ingroup").show()
    else
      $("#ingroup").hide()
  }
  function prepSQLparamsCheck(urlParams){
    var out="";
    out += "tableName="+"workerDemographicsPsychOffensiveness";
    out += "&workerId="+urlParams["workerId"];
    out += "&HITType="+urlParams["HITType"];
    out += "&assignmentId="+urlParams["assignmentId"];
    out += "&HITId="+urlParams["HITId"];
    return out;
  }
  function prepSQLparamsStore(){
    var out="";
    out += "tableName="+"workerDemographicsPsychOffensiveness";
    out += "&gender="+$("#annotatorGender").val();
    out += "&age="+$("#annotatorAge").val();
    out += "&race="+$("#annotatorRace").val();
    out += "&politics="+$('input[name="annotatorPolitics"]:checked').val();
    out += "&otherMinority="+encodeURIComponent($("#annotatorMinority").val());
    attitudeQuestions.forEach(function(e){
      out+= "&"+e+"="+$('input[name="'+e+'"]:checked').val();
    });
    
    return out;
  }
  function dealWithWorkerInfo(sqlResponse){
    if (sqlResponse == ""){
      /* we don't have this worker in our DB*/
      console.log("New worker!");
      $(".prefilled-message").hide();
      if (location.hostname == "homes.cs.washington.edu"){
        $("#consent").prop("checked",true);
        toggleConsent(true);
      }
    } else {
      workerInfo = JSON.parse(sqlResponse);
      console.log(workerInfo);
      // Bypass consent? Only on UW servers
      if (location.hostname == "homes.cs.washington.edu"){
        $("#consent").prop("checked",true);
        toggleConsent(true);
      }
      $(".prefilled-message").show();
      $("#annotatorGender").val(workerInfo["gender"]);
      $("#annotatorAge").val(workerInfo["age"]);
      $("#annotatorRace").val(workerInfo["race"]);
      //$("#annotatorPolitics").val(workerInfo["politics"]);
      $('#annotatorPolitics'+workerInfo["politics"]).prop("checked",true)
      $("#annotatorMinority").val(workerInfo["otherMinority"]);
      attitudeQuestions.forEach(function(e){
        $("#"+e+workerInfo[e]).prop("checked",true);
      });
    
    }
  }
  function checkIfWorkerExists(){
    var urlParams = getURLParams();
    var requestParams = "?"+prepSQLparamsCheck(urlParams)+"&action=check";//location.search+"&action=check";
    var requestURL = "https://homes.cs.washington.edu/~msap/debug/neural-detox/checkStoreWorkerDemographicsMore.php";
    var xhttp = new XMLHttpRequest();
    console.log(requestURL+requestParams);
    xhttp.open("POST", requestURL+requestParams, true);
    xhttp.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');
    xhttp.onreadystatechange = function() {
      if (this.readyState == 4 && this.status == 200) {
        //var responseRaw = this.responseText;
        dealWithWorkerInfo(this.responseText);
        //console.log("Received an answer!"+this.responseText);
      }
    };
    xhttp.send(requestParams);
  }
  function sendWorkerInfo(){
    var urlParams = getURLParams();
    var requestParams = "?"+prepSQLparamsCheck(urlParams)+"&action=store&"+prepSQLparamsStore();
    var requestURL = "https://homes.cs.washington.edu/~msap/debug/neural-detox/checkStoreWorkerDemographicsMore.php";
    var xhttp = new XMLHttpRequest();
    console.log(requestURL+requestParams);
    xhttp.open("POST", requestURL+requestParams, true);
    xhttp.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');
    xhttp.onreadystatechange = function() {
      if (this.readyState == 4 && this.status == 200) {
        //var responseRaw = this.responseText;
        //dealWithWorkerInfo(this.responseText);
        console.log("Received an answer: '"+this.responseText+"'");
      }
    };
    xhttp.send(requestParams);
  }
  function validate(){
    var valid, offensive, groupTargeted; //alertQoffensive2you

    valid = ($("input[name='toAI']:checked").length > 0);
    if (!valid){
      $("#alertQoffensive2you").show();
      window.location.hash = "#alertQoffensive2you"; window.scrollBy(0, -30);
      console.log("Missing answer to Q1a");
      return valid;
    } else {
      $("#alertQoffensive2you").hide();
    }
    
    valid = valid && ($("input[name='toPER']:checked").length > 0);
    if (!valid){
      $("#alertQoffensive").show();
      window.location.hash = "#alertQoffensive"; window.scrollBy(0, -30);
      console.log("Missing answer to Q1b");
      return valid;
    } else {
      $("#alertQoffensive").hide();
      offensive = ["yes","maybe"].includes($("input[name='toany']:checked").prop("value"));
    }
    
    valid = valid && ($("input[name='intent']:checked").length > 0);
    if (!valid){
      $("#alertQintent").show();
      window.location.hash = "#alertQintent"; window.scrollBy(0, -30);
      console.log("Missing answer to Q1c");
      return valid;
    } else {
      $("#alertQintent").hide();
    }

    valid = valid && $("input[name='lewd']:checked").length > 0;
    if (!valid){
      $("#alertQracist").show();
      window.location.hash = "#alertQracist"; window.scrollBy(0, -30);
      console.log("Missing answer to Q1d");
      return valid;
    } else {
      $("#alertQracist").hide();
    }
    
    // $("#annotatorGender").prop("value") != "please select";

    
    valid = valid && ($("input:invalid").length == 0);
    console.log("########## VALIDATING #########\nvalid? "+valid);
    $("input:invalid").each(function (i,e){
      console.log(e);
    });
    return valid;
  }
  function alertMinorityQs(val){
    if (val == "yes" && $(".btn-checkbox>input:checked").length == 0) {
      //$("#dummyMinority").prop("required","true");
      $("#alertQminority").show();
    } else {
      //$("#dummyMinority").prop("required","");
      $("#alertQminority").hide();
    }
  }
  var rows;
  function expExamples(){
    rows = $("tr.extra-rows");
    $("a:contains('examples')").each(function(ix,link){
      if (rows.hasClass("show"))
        link.innerText = "[+] more examples";
      else 
        link.innerText = "[-] less examples";
      console.log(link);
    })
  }

</script>
<style type="text/css">
#examples-table {
  border-style: none solid solid solid;
  border-width: 1px;
  border-color: #dee2e6;
  border-radius: 5px;
}

.card-header-accordion{
  padding: 0px 10px;
}
body, td, .btn { 
  font-size:0.85rem;
}
label {
  margin-bottom: 0px;
}
.story-excerpt {
  margin: 40px auto;
  min-width: 500px;
  border:2px #333333;
  background-color: #f2f2f2;
  border-style: solid;
  padding-right:10px;
  padding-left:10px;
  display:table;
  border-radius:15px;
}
.story-excerpt-example {
  border: 1px solid #666666;
  background-color: #f2f2f2;
  border-radius: 3px;
  padding: 3px;
  display: inline-block;
  margin: 10px;
}
span.numbering {
  font-weight: bold;
  margin-right: .5em;
}
#introQuestion>div>label>input,
#intentQuestion>div>label>input {
  vertical-align: middle;
}
.prefilled-message{
  font-style: italic;
}

#detailed-instructions>p {
  margin-bottom: 0px;
}
span.instrQuestion {
  background-color: #f2f2f2;
  font-style: italic;
  font-size: .9rem;
  margin: 5px 0 3px -15px;
  padding: 0 .3rem 0 .3rem;
  display: inline-block;
}
span.instrDescription {
  font-size: .9rem;
  margin-left: -15px;
}
label > input[type='text'] {
  width: 90%;
}
input[type='text'] {
  width: 300px;
}
input[type='text'].opt-target {
  background-color: #f8f8f8;
}

input[type="text"]:invalid {
  color: #a94442;
  background-color: #f2dede;
}

textarea#postText {
  margin-left: 20px;
  font-size: 12pt;
  width: auto;
  background-color: transparent;
  overflow: auto;
  resize: none;
}

.btn-checkbox, .btn-checkbox-two {
  .btn-light;
  color: black;
  text-align: left;
  margin: 0px;
  background-color: #e9ecef;
  border-color: #d1d4d7;
}

.col12{
  display = "inline-block";
}

.btn-checkbox.active,
.btn-checkbox:active,
.btn-checkbox:hover {
  background-color: #babcbf;
  border-color: #8b8d8f;
}

.btn-checkbox-two.active,
.btn-checkbox-two:active,
.btn-checkbox-two:hover {
  background-color: #babcbf;
  border-color: #8b8d8f;
}

.btn-group-vertical {
  max-width: 400px;
  /*margin-right: 10px;*/
}
#introQuestion, 
#minorityQuestions,
#demogQuestions {
  margin-bottom: 10px;
  margin-top: 10px;
}
.autocomplete-suggestions { 
  border: 1px solid #999;
  background: #FFF; 
  overflow: auto;
}
#dummyMinority {
  /*opacity:0;*/
  width: 0px;
}
.autocomplete-suggestion { padding: 2px 5px; white-space: nowrap; overflow: hidden; }
.autocomplete-selected { background: #F0F0F0; }
.autocomplete-suggestions strong { font-weight: normal; color: #3399FF; }
.autocomplete-group { padding: 2px 5px; }
.autocomplete-group strong { display: block; border-bottom: 1px solid #000; }

input[type='checkbox'] {
  /* All <input> elements that are immediate children of a class="btn-checkbox" */
  margin-right: 5px;
}
ul {
  padding-left: 30px;
  margin-bottom: 10px;
}
fieldset {
  padding: 10px;
  background:#fbfbfb;
  border-radius:5px; 
  margin-bottom:5px;
}
.lickert>label{
    font-style: italic;
  }
  

</style>